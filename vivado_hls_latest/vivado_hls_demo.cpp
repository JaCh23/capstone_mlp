#include <math.h>
#include <stdio.h>
#include <iostream>


struct AXIS_wLAST{
	float data;
	bool last;
};

//typedef ap_fixed<16, 15> data_t;
//typedef ap_fixed<16, 15> weight_t;

typedef float data_t;

const int VIVADO_INPUTS = 129;
const int PCA_COMPONENTS = 6;
const int N_INPUTS = 15;
const int N_HIDDEN_1 = 16;
const int N_HIDDEN_2 = 16;
const int N_OUTPUTS = 3;


const data_t mean[40*3] = {0.0069905218287804, 0.0069905479750667, 0.0069900787399058, 0.0207089068920958, 0.0207089643134083, 0.0207075626596458, 0.0406246442348875, 0.0406246953403667, 0.0406219121563708, 0.0659343939945896, 0.0659343394228812, 0.0659297501597500, 0.0955672291686667, 0.0955668860125417, 0.0955601057076667, 0.1282111431658334, 0.1282102321358750, 0.1282009302783750, 0.1623697821116250, 0.1623679081475000, 0.1623558349725417, 0.1964534739421250, 0.1964501257083334, 0.1964351246630000, 0.2289015104907500, 0.2288960468826666, 0.2288780812809166, 0.2583253455037500, 0.2583170109208333, 0.2582961770837500, 0.2836564435254167, 0.2836443566295833, 0.2836209037458334, 0.3042790537683333, 0.3042622393462500, 0.3042365673987500, 0.3201285830616667, 0.3201059711162500, 0.3200786383354167, 0.3317397815637500, 0.3317102306112500, 0.3316819518804166, 0.3402359543220834, 0.3401982802162500, 0.3401699013120833, 0.3472592833846666, 0.3472122673420000, 0.3471847469070833, 0.3548510274637500, 0.3547934559225000, 0.3547678459437500, 0.3652979203750000, 0.3652286020500000, 0.3652060042041666, 0.3809646676541666, 0.3808824675583334, 0.3808640077875000, 0.4041330144000000, 0.4040368842500000, 0.4040236613875000, 0.4368642134775000, 0.4367532147950000, 0.4367462860716667, 0.4808949585179167, 0.4807682832574999, 0.4807686180625000, 0.5375704719375000, 0.5374274605437500, 0.5374359320958334, 0.6078121975125000, 0.6076523615266666, 0.6076697332083334, 0.6921135217666666, 0.6919365224958334, 0.6919634058458333, 0.7905559462791667, 0.7903616052666665, 0.7903985101875001, 0.9028392007916666, 0.9026274569000000, 0.9026747589833334, 1.0283201425916666, 1.0280910733166666, 1.0281490350666667, 1.1660586499750001, 1.1658123957833333, 1.1658811893125001, 1.3148696799041668, 1.3146064592791664, 1.3146861940000001, 1.4733815489625000, 1.4731016043625000, 1.4731923193124998, 1.6400999539041667, 1.6398035011000001, 1.6399052029250001, 1.8134761471625001, 1.8131634119458335, 1.8132760613708332, 1.9919766398375001, 1.9916478037083332, 1.9917713763291669, 2.1741507375333335, 2.1738059339583335, 2.1739403805541664, 2.3586921945791670, 2.3583315473874999, 2.3584768126249998, 2.5444924772416670, 2.5441160476916664, 2.5442720920291664, 2.7306835760749997, 2.7302913836500000, 2.7304581502374998, 2.9166695890583338, 2.9162616322291663, 2.9164390896499999, 3.1021473871166667, 3.1017236578291669, 3.1019117787666670};

const data_t variance[40*3] = {0.0000707933934905, 0.0000707968386982, 0.0000707921627497, 0.0006246802867310, 0.0006247099275250, 0.0006246699725703, 0.0024252080593871, 0.0024253185984497, 0.0024251712377599, 0.0064709915766331, 0.0064712705840344, 0.0064709056825339, 0.0138366463543868, 0.0138372000679338, 0.0138364972820659, 0.0254897117024595, 0.0254906392204733, 0.0254895186797746, 0.0421086116555020, 0.0421099673215459, 0.0421084603550022, 0.0639309839883971, 0.0639327473689972, 0.0639310621405425, 0.0906624047999536, 0.0906644537227930, 0.0906630321340486, 0.1214719533339134, 0.1214740778160735, 0.1214736069488151, 0.1550917618264808, 0.1550936814467063, 0.1550950615918425, 0.1900219703505843, 0.1900234146077076, 0.1900276618360771, 0.2248210196649034, 0.2248217967598062, 0.2248299140265765, 0.2584365237613203, 0.2584366173144507, 0.2584494568293321, 0.2905120754655170, 0.2905117236818740, 0.2905298471929096, 0.3216002722913235, 0.3215999835530514, 0.3216235913011881, 0.3532284862575538, 0.3532290384915356, 0.3532580063343486, 0.3878024140129986, 0.3878047940203976, 0.3878387431764386, 0.4283806719080724, 0.4283859845127437, 0.4284244721615772, 0.4783928018008339, 0.4784021958666108, 0.4784448904990094, 0.5413866773972968, 0.5414012159992432, 0.5414481695390335, 0.6208724708845114, 0.6208931162454633, 0.6209448735178004, 0.7202886343210950, 0.7203162381644640, 0.7203739927279617, 0.8430677295829462, 0.8431031149331436, 0.8431687282236119, 0.9927462964544106, 0.9927903142507674, 0.9928662484571772, 1.1730530036528826, 1.1731067003275015, 1.1731959572800266, 1.3879235241079206, 1.3879881679478459, 1.3880941703861773, 1.6414184327758248, 1.6414957471552347, 1.6416221227627217, 1.9375511589823964, 1.9376433087326821, 1.9377937802210732, 2.2800551860822864, 2.2801648774209431, 2.2803431586032974, 2.6721326075628493, 2.6722630052815552, 2.6724726685975346, 3.1162274469378066, 3.1163820986250803, 3.1166265108917677, 3.6138616763383022, 3.6140445338405143, 3.6143267206132679, 4.1655633497246649, 4.1657785184052232, 4.1661013744069537, 4.7709040982209467, 4.7711557053332996, 4.7715217657274653, 5.4286499998742350, 5.4289423618618695, 5.4293538688393035, 6.1370180329140664, 6.1373552047856634, 6.1378141881844561, 6.8940155531310241, 6.8944013921950047, 6.8949096533388365, 7.6978374997641650, 7.6982756702169661, 7.6988348648008289, 8.5472847462748973, 8.5477787057518118, 8.5483906021010974};

const data_t pca_eigvecs[PCA_COMPONENTS*120] = {-0.0792833186168710, -0.0792837206998561, -0.0792837113026574, -0.0795719072685231, -0.0795723327480901, -0.0795723217137673, -0.0800004026883627, -0.0800008640185116, -0.0800008500605246, -0.0805655111652020, -0.0805660201822718, -0.0805660013441844, -0.0812653889357576, -0.0812659565476805, -0.0812659310760494, -0.0821006024677036, -0.0821012389243098, -0.0821012042929580, -0.0830745323733139, -0.0830752463619906, -0.0830751988278265, -0.0841929566281009, -0.0841937539754780, -0.0841936898511658, -0.0854623759749535, -0.0854632583829479, -0.0854631731888732, -0.0868868799725497, -0.0868878432123535, -0.0868877326351191, -0.0884634199041728, -0.0884644519704896, -0.0884643129971566, -0.0901754137337729, -0.0901764913436031, -0.0901763252378974, -0.0919848496264242, -0.0919859353191180, -0.0919857516508566, -0.0938239026365834, -0.0938249408305529, -0.0938247630304294, -0.0955886093135751, -0.0955895245370507, -0.0955893984077772, -0.0971394038199280, -0.0971401042367074, -0.0971401028412323, -0.0983151390332276, -0.0983155260868300, -0.0983157489383301, -0.0989654021038006, -0.0989653890228360, -0.0989659506208755, -0.0989970732558475, -0.0989966105993687, -0.0989976132999068, -0.0984170678928481, -0.0984161625699720, -0.0984176643816455, -0.0973459117050072, -0.0973446311066199, -0.0973466221539907, -0.0959889459825404, -0.0959874018798227, -0.0959898037882368, -0.0945779148772320, -0.0945762361135164, -0.0945789227082460, -0.0933123286315922, -0.0933106365674923, -0.0933134635243603, -0.0923240239560393, -0.0923224151199809, -0.0923252475789118, -0.0916701330670045, -0.0916686749855625, -0.0916714029177706, -0.0913460403944546, -0.0913447717825416, -0.0913473168905575, -0.0913065501800892, -0.0913054867412416, -0.0913078013686362, -0.0914865643261872, -0.0914857047597036, -0.0914877677181597, -0.0918169696449932, -0.0918163010607602, -0.0918181114878731, -0.0922347398174395, -0.0922342436903622, -0.0922358142650604, -0.0926880388990390, -0.0926876938416942, -0.0926890458921921, -0.0931377467917144, -0.0931375308189243, -0.0931386900692332, -0.0935568011761236, -0.0935566945287963, -0.0935576873505344, -0.0939284567910566, -0.0939284416671024, -0.0939292939070763, -0.0942441831567335, -0.0942442447027280, -0.0942449794091612, -0.0945016324187794, -0.0945017586967609, -0.0945023962401204, -0.0947028811196352, -0.0947030619401604, -0.0947036199074417, -0.0948530328508915, -0.0948532616571100, -0.0948537539230197, -0.0949591760288106, -0.0949594468384911, -0.0949598850139433, 0.1305247339357378, 0.1305238807330841, 0.1305243392325300, 0.1303197160177961, 0.1303187840086200, 0.1303192289376916, 0.1299502962173163, 0.1299492406014994, 0.1299496651188268, 0.1293424064900516, 0.1293411830567743, 0.1293415808069514, 0.1283986397905433, 0.1283971990452212, 0.1283975644446023, 0.1269996873484488, 0.1269979757250150, 0.1269983077863601, 0.1250053441751032, 0.1250032995854949, 0.1250036069277645, 0.1222548536802624, 0.1222524061929800, 0.1222527086008759, 0.1185671776962493, 0.1185642465268326, 0.1185645855040923, 0.1137415716809756, 0.1137380634028914, 0.1137385089182232, 0.1075593930871892, 0.1075551991107700, 0.1075558595885573, 0.0997893398690028, 0.0997843390274271, 0.0997853680041168, 0.0902002731120126, 0.0901943351358616, 0.0901959374454951, 0.0785874455783384, 0.0785804472314184, 0.0785828786892076, 0.0648186153609885, 0.0648104654615182, 0.0648140128588584, 0.0489029635348335, 0.0488936305303234, 0.0488985792753266, 0.0310737968836180, 0.0310633557598949, 0.0310699352130152, 0.0118556660016707, 0.0118443217344771, 0.0118526264687729, -0.0079313499852873, -0.0079432572456823, -0.0079333139655611, -0.0272684009336697, -0.0272804497691290, -0.0272691466612575, -0.0451242506182181, -0.0451360107854321, -0.0451237580676560, -0.0606584693931878, -0.0606695798618761, -0.0606568309919471, -0.0733537442839048, -0.0733639564634642, -0.0733511193473128, -0.0830383099038622, -0.0830474813974322, -0.0830348761364000, -0.0898232872333605, -0.0898313655989013, -0.0898192129200782, -0.0940069418150541, -0.0940139240030607, -0.0940023679393003, -0.0959859198547860, -0.0959918359563890, -0.0959809630571699, -0.0961896271502697, -0.0961945212113882, -0.0961843800399948, -0.0950376227192343, -0.0950415472599656, -0.0950321575009025, -0.0929143215805092, -0.0929173362040889, -0.0929086950642285, -0.0901554127161860, -0.0901575778571464, -0.0901496669002911, -0.0870420735636487, -0.0870434527446155, -0.0870362387440900, -0.0838003818488786, -0.0838010420304673, -0.0837944813289142, -0.0806041228713167, -0.0806041277403192, -0.0805981708138079, -0.0775795614158577, -0.0775789732458786, -0.0775735655201680, -0.0748111853439369, -0.0748100641348974, -0.0748051522299814, -0.0723477015136570, -0.0723460996174850, -0.0723416304877397, -0.0702078613832750, -0.0702058331282916, -0.0702017560986835, -0.0683858549192939, -0.0683834383893785, -0.0683797114913231, -0.0668561442887638, -0.0668533793826458, -0.0668499633928580, 0.1110726307770548, 0.1110717633211810, 0.1110668752230007, 0.1064236545974041, 0.1064227387905260, 0.1064178886726876, 0.0994861900733252, 0.0994851993949718, 0.0994804315730732, 0.0903109815265837, 0.0903098702787159, 0.0903052544869045, 0.0789711503189160, 0.0789698861510607, 0.0789655160964568, 0.0655656536927430, 0.0655641668418076, 0.0655601803858989, 0.0502232281111909, 0.0502214561815654, 0.0502180343134733, 0.0331071692441410, 0.0331050271653820, 0.0331024071001667, 0.0144212672342408, 0.0144186608064795, 0.0144171245529946, -0.0055812954365899, -0.0055844716590489, -0.0055845837312304, -0.0265836422155860, -0.0265874840252694, -0.0265858080865528, -0.0481821525270409, -0.0481867466289422, -0.0481828926738479, -0.0698525901936443, -0.0698579840050976, -0.0698515805425862, -0.0909079804058389, -0.0909141539293522, -0.0909049025686144, -0.1104592886642301, -0.1104661234121765, -0.1104538512906848, -0.1274040850365107, -0.1274113528654908, -0.1273960958010153, -0.1404821612199766, -0.1404895106916119, -0.1404715744590706, -0.1484342629594186, -0.1484412956585052, -0.1484212638611124, -0.1502611418016516, -0.1502674592894859, -0.1502461262654588, -0.1455058584329175, -0.1455111750558377, -0.1454894006565004, -0.1344270062711104, -0.1344311842614975, -0.1344097495938132, -0.1179638935259908, -0.1179669450956242, -0.1179464313661866, -0.0975122360459671, -0.0975142646597998, -0.0974950386991083, -0.0746280966495188, -0.0746292356365648, -0.0746114953212120, -0.0507796924036669, -0.0507800560477442, -0.0507638846943269, -0.0271996351385927, -0.0271993161415369, -0.0271847296851545, -0.0048277131543229, -0.0048267958552616, -0.0048137573752252, 0.0156889038812703, 0.0156903517445064, 0.0157019153383719, 0.0339662817455826, 0.0339681872092008, 0.0339783782282952, 0.0498415478394851, 0.0498438349311608, 0.0498527784188534, 0.0633261081212240, 0.0633286983863442, 0.0633365379423606, 0.0745587407134935, 0.0745615604886307, 0.0745684465982603, 0.0837617886263344, 0.0837647731311956, 0.0837708408536362, 0.0912026265213341, 0.0912057145433424, 0.0912110975169210, 0.0971618494579772, 0.0971650024722403, 0.0971698091808811, 0.1019087730660167, 0.1019119509142457, 0.1019162816005469, 0.1056840026692265, 0.1056871871586530, 0.1056911257362047, 0.1086887927454341, 0.1086919589854658, 0.1086955698778440, 0.1110803088896131, 0.1110834499121537, 0.1110867870713166, 0.1129721047799722, 0.1129752114893149, 0.1129783228146093, 0.1452587069803562, 0.1452460987937806, 0.1452499211669946, 0.1347322353940094, 0.1347192377035821, 0.1347230760372500, 0.1194721936172741, 0.1194586543721884, 0.1194625130483989, 0.1000910521961304, 0.1000767093493330, 0.1000806657238789, 0.0773593582739968, 0.0773440063716215, 0.0773481609176729, 0.0521769767170427, 0.0521603978695436, 0.0521648475621962, 0.0255469826774443, 0.0255289304092597, 0.0255338460109712, -0.0014497503362962, -0.0014695402222284, -0.0014639348260209, -0.0276742637325680, -0.0276960413885464, -0.0276895337825387, -0.0519457138368569, -0.0519697173910070, -0.0519620701873740, -0.0730532805683664, -0.0730796851588875, -0.0730707135255779, -0.0897700758212129, -0.0897990316843118, -0.0897886185418350, -0.1008824697042008, -0.1009140487665365, -0.1009021808438824, -0.1052512921035442, -0.1052854340301778, -0.1052722976788842, -0.1019286083273273, -0.1019651432307099, -0.1019511074684695, -0.0903508970848076, -0.0903895343706624, -0.0903751786926203, -0.0706007760931037, -0.0706411053914805, -0.0706271759874425, -0.0436722503772989, -0.0437138674408942, -0.0437011103911422, -0.0116038615554702, -0.0116463306873389, -0.0116353522917893, 0.0226686499237347, 0.0226257558259601, 0.0226346069931476, 0.0557791260050651, 0.0557362380732870, 0.0557429012639022, 0.0845659812391544, 0.0845235231226031, 0.0845281529729862, 0.1066160939485703, 0.1065745180788866, 0.1065773863276180, 0.1205340434016035, 0.1204938155764480, 0.1204951843664922, 0.1259267430104436, 0.1258882332493623, 0.1258883782197654, 0.1232100055792963, 0.1231734888485122, 0.1231726853662692, 0.1133545146352172, 0.1133200751113816, 0.1133186324177020, 0.0976450314430214, 0.0976127146997458, 0.0976109109110795, 0.0774837868922997, 0.0774535269523535, 0.0774516313532528, 0.0542445850263850, 0.0542162596250180, 0.0542145222968820, 0.0291759142629228, 0.0291493846347808, 0.0291479918435645, 0.0033455266962935, 0.0033206220194810, 0.0033197128703029, -0.0223826191538706, -0.0224060238741391, -0.0224064099711666, -0.0473485798752050, -0.0473706339438635, -0.0473704457104338, -0.0710828234194979, -0.0711036717579467, -0.0711029221284307, -0.0932855908164193, -0.0933053191868970, -0.0933040307243326, -0.1138040254254176, -0.1138227407386206, -0.1138209657023618, -0.1326095216589510, -0.1326273083971051, -0.1326251129361836, -0.1497758927452112, -0.1497928232782699, -0.1497902738894501, -0.1654583517107346, -0.1654745161550458, -0.1654716426682766, 0.1310085785891626, 0.1309909533514704, 0.1309981700739628, 0.1150797648658841, 0.1150621146696284, 0.1150694636878703, 0.0922110008263076, 0.0921933831484073, 0.0922008092351751, 0.0636482952662845, 0.0636306690327018, 0.0636384368320928, 0.0310396665026751, 0.0310219895308113, 0.0310303694579863, -0.0035987952262865, -0.0036164778922085, -0.0036070679202213, -0.0379454451499170, -0.0379632479058099, -0.0379522006598900, -0.0694774919736960, -0.0694955279161076, -0.0694821791559423, -0.0956063556721058, -0.0956246503894844, -0.0956082798474407, -0.1138556736606022, -0.1138741965744391, -0.1138541983947988, -0.1220845041379560, -0.1221032675625169, -0.1220789328341485, -0.1187495063851878, -0.1187684280342386, -0.1187394027060449, -0.1031985289031690, -0.1032175290903936, -0.1031837332593058, -0.0759766945487629, -0.0759956887207363, -0.0759572309820933, -0.0391026800795125, -0.0391215490326444, -0.0390790402211324, 0.0037751710549301, 0.0037563084831026, 0.0038022245454972, 0.0474927129412671, 0.0474734771804743, 0.0475221750237820, 0.0859299505703052, 0.0859100326607931, 0.0859609995663474, 0.1130876455567220, 0.1130665950254654, 0.1131195386843646, 0.1244736693262759, 0.1244511485226367, 0.1245060629548437, 0.1182863491268636, 0.1182624867179125, 0.1183193182726539, 0.0958491544470332, 0.0958242105959415, 0.0958826778366318, 0.0611154849456388, 0.0610900137269569, 0.0611497144674248, 0.0195489322204374, 0.0195232610463098, 0.0195836687308904, -0.0231132367922671, -0.0231387012046620, -0.0230781148790337, -0.0618314648668013, -0.0618565554407152, -0.0617962809826047, -0.0928319392988098, -0.0928566284789641, -0.0927970785620177, -0.1138019878469479, -0.1138262544529478, -0.1137679597312210, -0.1238103260892087, -0.1238342159110925, -0.1237775723144014, -0.1230599056748630, -0.1230834269186869, -0.1230288652405279, -0.1125681909093884, -0.1125912230559658, -0.1125391280536536, -0.0938453340192698, -0.0938679195829979, -0.0938185627903136, -0.0686150068636534, -0.0686370706121116, -0.0685906322681657, -0.0385974265057842, -0.0386190103846712, -0.0385755218360653, -0.0053588451506753, -0.0053798573582169, -0.0053393728853945, 0.0297823739008042, 0.0297618585295505, 0.0297995466280129, 0.0658037599875481, 0.0657838113090212, 0.0658188027283019, 0.1019926605161307, 0.1019733387693902, 0.1020058001206834, 0.1379324504448286, 0.1379136756007123, 0.1379438085875244, 0.1734676676593222, 0.1734495247194695, 0.1734774474745572, -0.1459561473591124, -0.1459043013156308, -0.1458686291583027, -0.1147936988459044, -0.1147412947629680, -0.1147087076689313, -0.0725103492312823, -0.0724568617985259, -0.0724295202100692, -0.0236853071565563, -0.0236303584198138, -0.0236101735792586, 0.0261926232275792, 0.0262489887694808, 0.0262603993783267, 0.0713723474570854, 0.0714313621743114, 0.0714316658284911, 0.1064684863776009, 0.1065300995481954, 0.1065180725954653, 0.1271065571287192, 0.1271713043055943, 0.1271454291781201, 0.1304932080355748, 0.1305610050646844, 0.1305206742538493, 0.1158655355369650, 0.1159369977988527, 0.1158817651561534, 0.0847595014423534, 0.0848337926110741, 0.0847645359201570, 0.0410328893339854, 0.0411099475378459, 0.0410275601225728, -0.0093816531614015, -0.0093020678772335, -0.0093959420820562, -0.0590274578689478, -0.0589458215146253, -0.0590493959170596, -0.0998200388233242, -0.0997367824135756, -0.0998487018648984, -0.1242980049502692, -0.1242138634951592, -0.1243332743763026, -0.1271712858621722, -0.1270872400874078, -0.1272137623527652, -0.1068846367248827, -0.1068021930627485, -0.1069355352185207, -0.0666291350700350, -0.0665504125925310, -0.0666901930034891, -0.0141245732272481, -0.0140519357948406, -0.0141972801586197, 0.0401129406992688, 0.0401774534172884, 0.0400282329130481, 0.0855062177824645, 0.0855605580273954, 0.0854098543300839, 0.1140467105127160, 0.1140901827571194, 0.1139400948835659, 0.1218475847694633, 0.1218802547032987, 0.1217333161704181, 0.1093285309222882, 0.1093510685578881, 0.1092090865057499, 0.0803539117937910, 0.0803675730180748, 0.0802322225973440, 0.0408705444321995, 0.0408764528544566, 0.0407490844966569, -0.0024974862121637, -0.0024979350961452, -0.0026165179705041, -0.0435955348929762, -0.0436010457554571, -0.0437106926647040, -0.0774936427356621, -0.0775031376247808, -0.0776043011382763, -0.1008331460523198, -0.1008454015302189, -0.1009386644868812, -0.1118289415369821, -0.1118433545039876, -0.1119295008896178, -0.1100426197389639, -0.1100583095080612, -0.1101384337873540, -0.0960338508222464, -0.0960501583748379, -0.0961254266734186, -0.0709897011307583, -0.0710062076407805, -0.0710775798608755, -0.0363921914074228, -0.0364084279229954, -0.0364768760717220, 0.0062408859825106, 0.0062251233626883, 0.0061586762749690, 0.0555268891670902, 0.0555117503617901, 0.0554470090649762, 0.1103137997891962, 0.1102994427281309, 0.1102357277260895, 0.1697021705342490, 0.1696887777102594, 0.1696252863482076};

const data_t W1[N_INPUTS][16] = {
	{-0.2841078042984009, -0.4825791120529175, -0.0915062502026558, 0.3175582587718964, -0.0656916499137878, 0.3467325270175934, 0.3475371599197388, 0.3780237138271332, -0.1658167093992233, -0.1738936603069306, -0.2641673386096954, -0.4155437946319580, -0.0617044605314732, 0.3709513545036316, -0.3632065355777740, 0.0978714600205422},
	{0.1405628323554993, 0.2915227711200714, 0.3169501721858978, -0.0546021424233913, -0.2156289964914322, -0.2940234243869782, -0.5193459987640381, 0.2808495163917542, -0.4656253457069397, -0.0580037385225296, 0.1609402149915695, 0.3874786794185638, -0.0412559397518635, -0.0606769286096096, 0.0201352909207344, 0.4446216225624084},
	{-0.1084808856248856, -0.2036961615085602, 0.3937819600105286, -0.0083011882379651, -0.1630559861660004, 0.3273887932300568, -0.5039420127868652, -0.3326869308948517, 0.2169911712408066, -0.2363031804561615, 0.0750516057014465, 0.0722599402070046, -0.2404455393552780, -0.2892969548702240, -0.3583703041076660, -0.0808324068784714},
	{-0.3624002337455750, -0.3934099078178406, 0.3413424193859100, -0.4342942833900452, -0.1809965968132019, 0.3563643097877502, 0.2031996250152588, 0.4225953817367554, 0.4025602936744690, 0.3570239245891571, -0.0980482324957848, 0.2554880380630493, -0.1152976155281067, -0.2011530697345734, 0.3646773099899292, 0.1111814305186272},
	{0.2055902779102326, -0.3412154316902160, -0.3132723271846771, 0.2703898549079895, -0.0028505246154964, 0.2326541841030121, 0.0471720993518829, 0.2876835167407990, 0.0235269963741302, 0.2605153918266296, 0.3971447348594666, -0.3322880566120148, 0.1970932781696320, -0.5285322070121765, 0.3868978619575500, -0.0340474806725979},
	{0.3150250315666198, 0.3277904093265534, 0.1600296348333359, 0.3228023350238800, 0.1135251000523567, 0.4001712799072266, 0.3474470973014832, -0.1637523472309112, 0.1379901170730591, -0.2269562482833862, -0.2208185493946076, -0.0622288286685944, 0.0537501610815525, 0.0197692513465881, 0.1719710230827332, -0.2901895046234131},
	{0.1521587967872620, 0.2154176086187363, 0.4825369715690613, 0.2665051817893982, 0.2068290561437607, 0.4460652172565460, -0.0384652465581894, 0.2870184183120728, -0.1041685491800308, 0.3130586445331574, 0.3294358849525452, -0.2976558804512024, -0.0652686506509781, -0.0199331473559141, 0.3910701572895050, 0.2940117716789246},
	{0.2893519997596740, 0.4624543786048889, 0.1613920181989670, 0.0948745012283325, -0.1728782802820206, 0.3100495338439942, 0.3097433745861054, -0.5369076132774353, 0.3848944008350372, 0.3601534366607666, -0.2385372817516327, 0.4743038713932037, -0.2887890040874481, -0.2619296610355377, 0.1932394057512283, -0.1939888596534729},
	{-0.1930671036243439, -0.1648955196142197, 0.4646363854408264, -0.0072034471668303, 0.2601879835128784, 0.2969797551631928, 0.1213453635573387, -0.2297539710998535, 0.0651407539844513, 0.3047478795051574, 0.3567993938922882, -0.1425755769014358, -0.3151898086071014, -0.4065316319465637, 0.2948185205459594, -0.2541697025299072},
	{-0.4261550307273864, 0.0329229943454266, 0.3245612978935242, 0.0041879243217409, 0.2363658845424652, 0.3336867392063141, 0.1503374725580216, -0.1716404259204864, -0.5313264131546021, -0.1139219030737877, -0.4205785691738128, -0.1488438546657562, 0.0008752828580327, 0.3084400296211242, -0.2623748183250427, -0.0381808951497078},
	{0.1792056411504746, 0.0692157819867134, 0.0289879553020000, -0.3001979589462280, 0.1094268560409546, 0.2156349271535874, -0.2308695018291474, 0.3705946207046509, 0.4816794693470001, -0.3395403027534485, 0.3375464975833893, 0.1338491737842560, 0.1846305429935455, 0.1737909317016602, 0.4357984662055969, 0.2190172970294952},
	{-0.1225811392068863, -0.3065328598022461, 0.2862944602966308, -0.2899143397808075, 0.2491417676210404, -0.3199145495891571, 0.2674160897731781, 0.1828733235597610, 0.2215806096792221, -0.0059314388781786, -0.0171560663729906, -0.0450503639876842, 0.0311718191951513, -0.0663217902183533, 0.3881706893444062, 0.2879002690315246},
	{-0.2634993493556976, 0.0370270535349846, 0.0383583121001720, 0.3274484574794770, -0.3084117472171784, 0.2657236754894256, -0.1002790927886963, 0.3418744802474976, -0.0996769815683365, -0.1310455203056336, -0.1972517371177673, -0.2453963011503220, 0.1981890648603439, -0.1118936538696289, 0.0534652434289455, -0.2701091766357422},
	{0.1990031003952026, -0.0309071037918329, 0.4239020049571991, -0.2062267512083054, 0.3107976913452148, -0.2728344500064850, 0.1831728518009186, 0.4434681832790375, -0.0096258213743567, 0.3763417303562164, 0.1857235878705978, 0.1675043404102326, 0.1792636066675186, 0.0378220491111279, 0.1489076614379883, -0.1430245041847229},
	{-0.3662113845348358, -0.0172044411301613, -0.2236735969781876, 0.0803253799676895, 0.2693997919559479, 0.3480166792869568, -0.2079451084136963, 0.2649633586406708, -0.2065200507640838, -0.1354392766952515, 0.3958866894245148, 0.1062261238694191, 0.3186827301979065, 0.3201348185539246, -0.1118481680750847, 0.1929676681756973}
};

const data_t B1[16] = {-0.0228268802165985, 0.0606366768479347, 0.0870706140995026, -0.0508043691515923, 0.0719731152057648, -0.0710615217685700, 0.1310121566057205, 0.1364837437868118, -0.0019369013607502, -0.0378960184752941, -0.0055888998322189, 0.0820484831929207, -0.0618128217756748, 0.1103233098983765, 0.0345087461173534, 0.1076351106166840};

const data_t W2[16][16] = {
	{-0.1939662992954254, 0.3227706253528595, 0.3880824446678162, -0.0777295529842377, 0.0535319596529007, -0.1337284445762634, -0.2578356266021728, -0.0115610510110855, 0.3737744987010956, -0.0302304849028587, 0.0815020278096199, 0.1143529117107391, 0.3248283565044403, 0.0910665690898895, 0.2453083544969558, -0.0528996177017689},
	{0.3359107077121734, -0.2073670774698258, 0.6773899197578430, 0.1118630319833756, -0.4621134698390961, 0.0492528080940247, -0.3224546313285828, -0.1051764786243439, 0.3761561214923858, 0.3996458649635315, 0.0406694673001766, 0.2032183706760406, -0.3617753684520722, -0.1693234741687775, -0.2011619061231613, 0.2262605577707290},
	{-0.1457262486219406, -0.1643307507038116, 0.1759564578533172, 0.2467288970947266, -0.1101176664233208, 0.0229925569146872, -0.0441427230834961, -0.0361728258430958, -0.0863299742341042, 0.3966240882873535, -0.2624529898166656, -0.2071802318096161, -0.1136896237730980, -0.3892198503017426, 0.3368228673934936, -0.2518886625766754},
	{0.0887597799301148, -0.0837575197219849, 0.5023397803306580, 0.0286137610673904, -0.2853318750858307, 0.0924487933516502, 0.1331937611103058, -0.2308471947908402, -0.4192036390304566, 0.1734606176614761, -0.1081000491976738, 0.3462646007537842, 0.1468078196048736, -0.2993230521678924, -0.0238303747028112, -0.0325793996453285},
	{-0.2128232568502426, -0.2638539969921112, -0.3458461165428162, 0.0849110335111618, 0.1503570526838302, 0.4092230498790741, -0.1627116799354553, -0.2459746003150940, -0.0938170850276947, 0.2195918262004852, -0.1873389929533005, -0.2362582534551620, 0.3784579336643219, 0.1068995893001556, 0.1648025810718536, -0.2949860095977783},
	{0.3349091112613678, -0.1061164438724518, 0.1918060928583145, -0.3149476647377014, 0.1821858882904053, -0.0947048515081406, -0.1078813076019287, 0.1070351749658585, -0.3877081871032715, 0.0440757311880589, 0.2932604849338532, 0.1264041066169739, -0.1320838332176208, -0.1525355875492096, 0.3171890079975128, -0.0523255839943886},
	{-0.3261443078517914, -0.1255347430706024, 0.4746338427066803, 0.1098291277885437, 0.1685312092304230, 0.2457935512065888, -0.1684992015361786, 0.5219855904579163, -0.4018001854419708, -0.6351125836372375, 0.1173965632915497, 0.2417736202478409, 0.4474582970142364, -0.2334539443254471, 0.0723945647478104, 0.4079725444316864},
	{-0.2326742708683014, -0.1111724376678467, 0.1650582700967789, 0.1610859930515289, -0.0549098588526249, 0.5373473167419434, 0.2229496538639068, -0.2785711288452148, -0.3943633735179901, -0.2896579205989838, -0.1658420264720917, 0.2514544427394867, 0.5210018754005432, 0.3093368709087372, -0.4675222039222717, 0.2016882747411728},
	{0.3458598852157593, 0.2395546138286590, -0.3491101861000061, 0.2533593177795410, 0.4832393527030945, 0.0410278253257275, 0.3737985193729400, 0.4592529535293579, 0.3126751184463501, 0.0420370697975159, 0.6612593531608582, -0.2993807196617126, 0.3581030368804932, 0.2402353584766388, -0.0083982534706593, 0.2851377725601196},
	{0.1159318983554840, -0.0453284084796906, -0.3309906423091888, -0.2130100131034851, 0.2687468528747558, -0.2721239328384400, -0.2753384113311768, 0.0519900023937225, 0.3058880865573883, -0.1014456972479820, 0.2190070748329162, 0.0853103995323181, -0.0712107047438622, 0.2641578018665314, -0.0884880721569061, 0.3329544663429260},
	{-0.0206319876015186, 0.1356189548969269, 0.1598261147737503, -0.3188143670558930, 0.1969325691461563, -0.4714666306972504, -0.1774978637695312, 0.2778433859348297, -0.2691907584667206, 0.2162784785032272, -0.2239114791154862, -0.2861168682575226, 0.0253255479037762, -0.3077755868434906, -0.3886713385581970, 0.3382361233234406},
	{0.1246669590473175, -0.2817505598068238, 0.6428665518760681, 0.0461144596338272, -0.2886228561401367, 0.1402300894260406, -0.2974854111671448, -0.0311371777206659, -0.2887001931667328, 0.3866108357906342, 0.0247960537672043, -0.4172613322734833, -0.3459378480911255, -0.1140291392803192, 0.3170691132545471, -0.0965839549899101},
	{-0.0195863302797079, -0.2587873935699463, 0.3789008557796478, 0.2960121929645538, -0.4717663228511810, -0.2147568464279175, -0.3001285195350647, -0.2217478603124618, 0.1389403641223908, -0.2679064571857452, 0.3234259784221649, 0.0048249457031488, -0.0813185721635818, 0.2529430687427521, -0.3068571090698242, 0.3763187825679779},
	{-0.0065899603068829, -0.0671775639057159, -0.0663355961441994, -0.0972353368997574, -0.0570351257920265, 0.1680052280426026, -0.3483445048332214, -0.1656008660793304, -0.1901540607213974, -0.1275827437639236, -0.3371904194355011, -0.1741300225257874, -0.0462636090815067, -0.4243787825107574, 0.1509914100170136, 0.0370125286281109},
	{0.3610777556896210, -0.2766602039337158, -0.4112821817398072, 0.3935360908508301, 0.0239856410771608, -0.4713164567947388, -0.0324654281139374, -0.2737648487091064, -0.3836188018321991, -0.0030468658078462, -0.1152813434600830, -0.0885490626096726, 0.2115814089775086, -0.3312816917896271, 0.4151437580585480, 0.1373470276594162},
	{0.0190141089260578, -0.2604299783706665, 0.6783740520477295, -0.2282217592000962, 0.0453275330364704, 0.4252642095088958, -0.2112092971801758, 0.2552666664123535, -0.3758817315101624, -0.0033266369719058, -0.1677997708320618, -0.1296105682849884, -0.1013018414378166, 0.3952220976352692, -0.2281952351331711, 0.2681168019771576}
};

const data_t B2[16] = {-0.0563986152410507, 0.0000000000000000, 0.1127291172742844, -0.0461226068437099, -0.0396525003015995, 0.1089870259165764, 0.0000000000000000, -0.0071458574384451, -0.0244879890233278, 0.0785327628254890, 0.0613808184862137, -0.0917775332927704, 0.1751865446567536, 0.0000000000000000, -0.0115341860800982, -0.0464665032923222};

const data_t W3[16][N_OUTPUTS] = {
	{0.3759425282478332, -0.2026435136795044, 0.3824985623359680},
	{0.3696715831756592, -0.1997807025909424, 0.2412182092666626},
	{-0.2746243476867676, -0.0025636726059020, -0.4733025431632996},
	{-0.3773033320903778, -0.5431557297706604, -0.3426438868045807},
	{-0.4723353683948517, -0.4283320009708404, 0.2761880755424500},
	{-0.4225980937480926, 0.1238426864147186, -0.6758074760437012},
	{-0.2101689577102661, 0.4213141798973084, 0.2823228836059570},
	{-0.4143587052822113, 0.0511676743626595, 0.1491777598857880},
	{0.2114139944314957, -0.2057456076145172, 0.3174232840538025},
	{0.3877964913845062, -0.4483114778995514, -0.5539972782135010},
	{-0.7083372473716736, -0.3853439390659332, 1.0350797176361084},
	{0.1974411755800247, -0.3390109837055206, 0.3450276255607605},
	{-0.6584046483039856, 0.3524761795997620, -0.1830606013536453},
	{-0.2250299751758576, -0.0005627274513245, 0.5055119395256042},
	{-0.1423915475606918, -0.4771921038627625, -0.2003010958433151},
	{-0.0064899525605142, 0.1719179302453995, 0.2911084890365600}
};

const data_t B3[N_OUTPUTS] = {-0.0490969754755497, 0.0939564183354378, -0.0828992500901222};

void print_arr(data_t arr[], int size) {
    for (int i = 0; i < size; i++) {
        printf("arr[%d] = %f\n", i, arr[i]);
    }
}


data_t relu(data_t x) {
    return x < 0 ? (data_t)0.0 : x;
}

data_t sigmoid(data_t x) {
    return 1.0 / (1.0 + std::exp(-x));
}

void softmax(data_t input[N_OUTPUTS], data_t output[N_OUTPUTS]) {
    data_t max_val = input[0];
    for (int i = 1; i < N_OUTPUTS; i++) {
        if (input[i] > max_val) {
            max_val = input[i];
        }
    }

    data_t sum = 0.0;
    for (int i = 0; i < N_OUTPUTS; i++) {
        output[i] = std::exp(input[i] - max_val);
        sum += output[i];
    }

    for (int i = 0; i < N_OUTPUTS; i++) {
        output[i] /= sum;
    }
}

void pca_mlp(data_t input[VIVADO_INPUTS]){

	data_t action[40][3];
	    for (int i = 0; i < 40; i++) {
	        for (int j = 0; j < 3; j++) {
	            action[i][j] = input[i*3+j];
	        }
	    }

	    data_t scaled_action[40][3];
	    for (int i = 0; i < 40; i++) {
	        for (int j = 0; j < 3; j++) {
	            scaled_action[i][j] = (action[i][j] - mean[i*3+j]) / std::sqrt(variance[i*3+j]);
	        }
	    }

	    data_t scaled_action_vec[120];
	    int k = 0;
	    for (int i = 0; i < 40; i++) {
	        for (int j = 0; j < 3; j++) {
	            scaled_action_vec[k] = scaled_action[i][j];
	            k++;
	        }
	    }

	// declare a 2D array with dimensions 120 x 5
	data_t pca_eigvecs_2d[PCA_COMPONENTS][120];

	// copy the data from the 1D array to the 2D array
	for (int i = 0; i < PCA_COMPONENTS; i++) {
		for (int j = 0; j < 120; j++) {
			pca_eigvecs_2d[i][j] = pca_eigvecs[120*i + j];
		}
	}

	data_t pca_action[PCA_COMPONENTS];
	for (int i = 0; i < PCA_COMPONENTS; i++) {
		pca_action[i] = 0;
		for (int j = 0; j < 120; j++) {
			pca_action[i] += scaled_action_vec[j] * pca_eigvecs_2d[i][j];
		}
	}

	data_t mlp_input[N_INPUTS];
	for (int i = 0; i < PCA_COMPONENTS; i++) {
		mlp_input[i] = pca_action[i];
	}
	for (int i = 0; i < N_INPUTS-PCA_COMPONENTS; i++) {
		mlp_input[PCA_COMPONENTS+i] = input[120+i];
	}


// Compute the output of the hidden layer
data_t hidden1[N_HIDDEN_1];
for (int i = 0; i < N_HIDDEN_1; i++) {
		hidden1[i] = B1[i];
		for (int j = 0; j < N_INPUTS; j++) {
			hidden1[i] += mlp_input[j] * W1[j][i];
		}
		hidden1[i] = relu(hidden1[i]);
	}

	// print array for hidden
	// print_arr(hidden1, N_HIDDEN_1);

	// for (int i = 0; i < 1; i++) {
	// 	for (int j = 0; j < 20; j++) {
	// 		std::cout << hidden1[j] << " ";
	// 	}
	// 	std::cout << std::endl;
	// }

	// Compute the output of the second hidden layer
	data_t hidden2[N_HIDDEN_2];
	for (int i = 0; i < N_HIDDEN_2; i++) {
		hidden2[i] = B2[i];
		for (int j = 0; j < N_HIDDEN_1; j++) {
			hidden2[i] += hidden1[j] * W2[j][i];
		}
		hidden2[i] = relu(hidden2[i]);
	}

	// Compute the output of the output layer
	data_t output_raw[N_OUTPUTS];
	data_t output[N_OUTPUTS];
	for (int i = 0; i < N_OUTPUTS; i++) {
		output_raw[i] = B3[i];
		for (int j = 0; j < N_HIDDEN_2; j++) {
			output_raw[i] += hidden2[j] * W3[j][i];
		}
	}
	softmax(output_raw, output);

	print_arr(output, 3);
}

int main() {
    data_t test_case[129] = {0.0020999587140977, 0.0021000567357987, 0.0020995649974793, 0.0059519018977880, 0.0059522045776248, 0.0059507247060537, 0.0109035763889551, 0.0109042059630156, 0.0109012341126800, 0.0160901285707951, 0.0160912275314331, 0.0160862524062395, 0.0205694101750851, 0.0205711442977190, 0.0205636546015739, 0.0234920922666788, 0.0234946422278881, 0.0234841313213110, 0.0242903344333172, 0.0242938883602619, 0.0242798756808043, 0.0228662155568600, 0.0228709392249584, 0.0228529907763004, 0.0197483617812395, 0.0197543650865555, 0.0197321232408285, 0.0161842480301857, 0.0161915421485901, 0.0161647554486990, 0.0141461584717035, 0.0141546092927456, 0.0141231669113040, 0.0162425301969051, 0.0162518024444580, 0.0162157732993364, 0.0255417972803116, 0.0255513191223145, 0.0255109835416079, 0.0453336387872696, 0.0453425683081150, 0.0452984496951103, 0.0788668692111969, 0.0788740813732147, 0.0788269639015198, 0.1291022598743439, 0.1291063874959946, 0.1290573179721832, 0.1985175758600235, 0.1985170245170593, 0.1984673142433167, 0.2889867126941681, 0.2889797389507294, 0.2889308929443359, 0.4017351269721985, 0.4017199277877808, 0.4016735851764679, 0.5373607873916626, 0.5373354554176331, 0.5372934341430664, 0.6958984136581421, 0.6958612799644470, 0.6958253383636475, 0.8769025206565857, 0.8768519163131714, 0.8768237233161926, 1.0795278549194336, 1.0794624090194702, 1.0794434547424316, 1.3025987148284912, 1.3025171756744385, 1.3025087118148804, 1.5446652173995972, 1.5445663928985596, 1.5445696115493774, 1.8040549755096436, 1.8039381504058838, 1.8039537668228149, 2.0789284706115723, 2.0787930488586426, 2.0788216590881348, 2.3673443794250488, 2.3671898841857910, 2.3672316074371338, 2.6673340797424316, 2.6671600341796875, 2.6672151088714600, 2.9769828319549561, 2.9767889976501465, 2.9768574237823486, 3.2945051193237305, 3.2942912578582764, 3.2943730354309082, 3.6183056831359863, 3.6180717945098877, 3.6181666851043701, 3.9470188617706299, 3.9467647075653076, 3.9468727111816406, 4.2795248031616211, 4.2792501449584961, 4.2793712615966797, 4.6149444580078125, 4.6146492958068848, 4.6147832870483398, 4.9526171684265137, 4.9523019790649414, 4.9524483680725098, 5.2920694351196289, 5.2917342185974121, 5.2918930053710938, 5.6329793930053711, 5.6326241493225098, 5.6327953338623047, 5.9751520156860352, 5.9747762680053711, 5.9749598503112793, 6.3184947967529297, 6.3180990219116211, 6.3182945251464844, 6.3163948059082031, 6.3159990310668945, 6.3161950111389160, 0.0000000000000000, 2.0000000000000000, 1.0000627040863037, 1.0000315904617310, 0.9999689459800720, 1.4096827228017381};
	pca_mlp(test_case);
    return 0;
}