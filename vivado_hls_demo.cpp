#include <math.h>
#include <stdio.h>
#include <iostream>


struct AXIS_wLAST{
	float data;
	bool last;
};

//typedef ap_fixed<16, 15> data_t;
//typedef ap_fixed<16, 15> weight_t;

typedef float data_t;

const int VIVADO_INPUTS = 128; 
const int PCA_COMPONENTS = 6;
const int N_INPUTS = 14;
const int N_HIDDEN_1 = 16;
const int N_HIDDEN_2 = 16;
const int N_OUTPUTS = 4;


const data_t mean[40*3] = {0.0006229680586668, -0.0001848581366867, 0.0000609808014632, 0.0018579244722831, -0.0005316476440635, 0.0001496943517993, 0.0036803083444874, -0.0009936371843165, 0.0002011597777847, 0.0060474733419026, -0.0014990034033545, 0.0001218238094507, 0.0088935916121793, -0.0019499747599405, -0.0002055844809233, 0.0121253927425736, -0.0022233010490382, -0.0009154859938525, 0.0156203047084050, -0.0021729234963545, -0.0021511956517773, 0.0192280706161460, -0.0016352574180252, -0.0040555261832888, 0.0227763210496779, -0.0004371007687960, -0.0067607105946625, 0.0260799342765970, 0.0015943838766273, -0.0103784585659503, 0.0289533683315086, 0.0046205527332063, -0.0149908954684257, 0.0312245912374794, 0.0087802333891525, -0.0206431633527957, 0.0327489552554850, 0.0141798831906086, -0.0273382517915843, 0.0334214062800218, 0.0208858540929128, -0.0350344669873504, 0.0331856319994346, 0.0289193055528950, -0.0436457208376447, 0.0320391148611266, 0.0382539067360308, -0.0530446736821154, 0.0300336221522227, 0.0488161536772609, -0.0630685158953897, 0.0272711790764057, 0.0604879057452890, -0.0735270060445642, 0.0238960521559415, 0.0731106860545022, -0.0842122213735393, 0.0200837411260796, 0.0864913972532995, -0.0949093266545772, 0.0160281506255916, 0.1004091974389142, -0.1054075753340352, 0.0119282549461226, 0.1146233897145319, -0.1155107314603158, 0.0079754960710919, 0.1288822160581381, -0.1250461513359139, 0.0043428978032789, 0.1429323666081407, -0.1338718884426691, 0.0011765765091544, 0.1565289115266609, -0.1418813785711996, -0.0014100443603858, 0.1694451933188150, -0.1490054948285615, -0.0033392744997172, 0.1814820703084389, -0.1552120228789784, -0.0045697229175329, 0.1924758476034027, -0.1605028198070510, -0.0050947683864604, 0.2023042369594474, -0.1649091113138464, -0.0049393351552822, 0.2108897937436942, -0.1684855340317646, -0.0041554287652126, 0.2182004594528574, -0.1713035688242554, -0.0028167381864836, 0.2242470376764154, -0.1734449216351762, -0.0010125839466742, 0.2290777062838933, -0.1749953614391229, 0.0011585224961103, 0.2327699378776462, -0.1760393548563331, 0.0035955144201309, 0.2354204447594302, -0.1766557064606202, 0.0062013986421646, 0.2371339230382794, -0.1769141359714825, 0.0088895756613654, 0.2380115439013624, -0.1768728248068538, 0.0115894996234250, 0.2381401510346386, -0.1765766626018149, 0.0142513288207071, 0.2375831820513373, -0.1760561409780128, 0.0168492869880378, 0.2363740685055206, -0.1753266589062997};

const data_t variance[40*3] = {0.0000006259609051, 0.0000002360936827, 0.0000007004772549, 0.0000054911187821, 0.0000020613910238, 0.0000061901243157, 0.0000211418206937, 0.0000079075601354, 0.0000241066270186, 0.0000558429965371, 0.0000209179797416, 0.0000646909353927, 0.0001180914304830, 0.0000447822970493, 0.0001396556577651, 0.0002151800987477, 0.0000840568334655, 0.0002611054747103, 0.0003521213481831, 0.0001451120420602, 0.0004406972757942, 0.0005311419276098, 0.0002376049913902, 0.0006891447738495, 0.0007518004255929, 0.0003761141098677, 0.0010160787322182, 0.0010116068474069, 0.0005813949131334, 0.0014302055448423, 0.0013068975200435, 0.0008807087299208, 0.0019396551721811, 0.0016336838537859, 0.0013068714066787, 0.0025523849773649, 0.0019882551270569, 0.0018960181742523, 0.0032764968533225, 0.0023674493938230, 0.0026844584653217, 0.0041203577767980, 0.0027686347668870, 0.0037052760515717, 0.0050924488918027, 0.0031895217768858, 0.0049854018975244, 0.0062009545202683, 0.0036279524706467, 0.0065437357293545, 0.0074531640638990, 0.0040817699383165, 0.0083905741529176, 0.0088548124545338, 0.0045488224502888, 0.0105282219378571, 0.0104094939444948, 0.0050271118617715, 0.0129523687452864, 0.0121182619700450, 0.0055150604629433, 0.0156536495071289, 0.0139794737188288, 0.0060118516747896, 0.0186188326326233, 0.0159888825027924, 0.0065177863066506, 0.0218312496484667, 0.0181399228761495, 0.0070345736201773, 0.0252703192739819, 0.0204240817723765, 0.0075654694753193, 0.0289102831695917, 0.0228312130451935, 0.0081151909499329, 0.0327184819865383, 0.0253496467474642, 0.0086895519455958, 0.0366536396414606, 0.0279659915740092, 0.0092948393241843, 0.0406646816970622, 0.0306645972343994, 0.0099370058459116, 0.0446905577028596, 0.0334267551038046, 0.0106208195269270, 0.0486613923133493, 0.0362298002668458, 0.0113491371461442, 0.0525010330398732, 0.0390463712667648, 0.0121224505033181, 0.0561307290756745, 0.0418440541377882, 0.0129388403532505, 0.0594734326427017, 0.0445856429584379, 0.0137944332445380, 0.0624580810578106, 0.0472301687794314, 0.0146844137472006, 0.0650232960315193, 0.0497347658799184, 0.0156046055214348, 0.0671201492182896, 0.0520573427151915, 0.0165535337381773, 0.0687139522229305, 0.0541599523926671, 0.0175347520269821, 0.0697852644865204, 0.0560124711951007, 0.0185590739511223, 0.0703303677353032, 0.0575962153815083, 0.0196462309051803, 0.0703613974601315, 0.0589069008329044};

const data_t pca_eigvecs[PCA_COMPONENTS*120] = {-0.0860144231598407, 0.0447740457501707, 0.0631651255763819, -0.0871319728188925, 0.0444460084038977, 0.0636681831083905, -0.0887668642006408, 0.0437428429547900, 0.0643920263020697, -0.0908703641749539, 0.0424171348100150, 0.0653018840429901, -0.0933795883451435, 0.0401648703414253, 0.0663557193611615, -0.0962178968560075, 0.0366760767977479, 0.0675072508394193, -0.0992957283985305, 0.0317193705216586, 0.0687092639709785, -0.1025122186805932, 0.0252366611699538, 0.0699174698335294, -0.1057581374039438, 0.0173968648694355, 0.0710933562937658, -0.1089203980248898, 0.0085625029262410, 0.0722068075144537, -0.1118886669281400, -0.0008192830898478, 0.0732376173786243, -0.1145636705695081, -0.0103362255159810, 0.0741760843013521, -0.1168658134907928, -0.0196814301969391, 0.0750226041644120, -0.1187423111310640, -0.0286642057184368, 0.0757864305594721, -0.1201711652116568, -0.0371851248642750, 0.0764836605803231, -0.1211611716694524, -0.0452021300721990, 0.0771346892267042, -0.1217481424410008, -0.0527024443075601, 0.0777613486991254, -0.1219885434199217, -0.0596841820316140, 0.0783840682432636, -0.1219519885015831, -0.0661464320696745, 0.0790193621095342, -0.1217138675838516, -0.0720853370877929, 0.0796778512084209, -0.1213488998734516, -0.0774939292688297, 0.0803629414215449, -0.1209259667003992, -0.0823641156772877, 0.0810701801493781, -0.1205043378559358, -0.0866896727874466, 0.0817873081769655, -0.1201313167654403, -0.0904694085195210, 0.0824950053677736, -0.1198412951048709, -0.0937099083535517, 0.0831683624974953, -0.1196561456596491, -0.0964274377180670, 0.0837790484424187, -0.1195867944257914, -0.0986487723854085, 0.0842979854722902, -0.1196355206419731, -0.1004109047388959, 0.0846982812926074, -0.1197984911092705, -0.1017597229779078, 0.0849580121925520, -0.1200678869170955, -0.1027478990125624, 0.0850624206570378, -0.1204332393541738, -0.1034323022647360, 0.0850052234379393, -0.1208818689233387, -0.1038712639193692, 0.0847887861557762, -0.1213985564562770, -0.1041219878020123, 0.0844231953544872, -0.1219646578181254, -0.1042382384267170, 0.0839243329890176, -0.1225568847436885, -0.1042683408405128, 0.0833112302211205, -0.1231458597027944, -0.1042533899896147, 0.0826029716596746, -0.1236946128215885, -0.1042255426567972, 0.0818155238750749, -0.1241574366636483, -0.1042062662738856, 0.0809587805342626, -0.1244798592152614, -0.1042045650105975, 0.0800341618835319, -0.1246007066337136, -0.1042152427308128, 0.0790330500946956, -0.0801947721434989, 0.0186419777461327, -0.1127443287099308, -0.0806555866270625, 0.0165220094527716, -0.1140109274613347, -0.0812894260734059, 0.0132009054473302, -0.1158232639727308, -0.0820284109273060, 0.0085478357413995, -0.1180802943774921, -0.0827842107994876, 0.0024608300565727, -0.1206548267237049, -0.0834501279981992, -0.0050615728640931, -0.1234000804867105, -0.0839042392193052, -0.0138480619144576, -0.1261579524135431, -0.0840144264394834, -0.0235214307119814, -0.1287693298008487, -0.0836455788357675, -0.0335484911904391, -0.1310848066449220, -0.0826697754873976, -0.0433672309267977, -0.1329753639018964, -0.0809789004596899, -0.0525244379412744, -0.1343423660504311, -0.0784978474986512, -0.0607499098135950, -0.1351253849387027, -0.0751959313012100, -0.0679486821272416, -0.1353071046457562, -0.0710941304882321, -0.0741457348423947, -0.1349142498149102, -0.0662661023099261, -0.0794257622606159, -0.1340141693843414, -0.0608326486233669, -0.0838900699656915, -0.1327072061749942, -0.0549507463927219, -0.0876334108211801, -0.1311158552456596, -0.0487994591241201, -0.0907352916075604, -0.1293723725875465, -0.0425650251939874, -0.0932596151527780, -0.1276066805893973, -0.0364272396393131, -0.0952581679100302, -0.1259361075061550, -0.0305482702614315, -0.0967752965451135, -0.1244578810021257, -0.0250645826575605, -0.0978522846618701, -0.1232446292887666, -0.0200821219658557, -0.0985306641384174, -0.1223426661392736, -0.0156744403128732, -0.0988541326162462, -0.1217726121501664, -0.0118833202978562, -0.0988690806041777, -0.1215318304644413, -0.0087212966967626, -0.0986239784440822, -0.1215981763895677, -0.0061755678483538, -0.0981680009051256, -0.1219346129336142, -0.0042126928746921, -0.0975493440146446, -0.1224942155305094, -0.0027837894650782, -0.0968136068996599, -0.1232251346001048, -0.0018298143877656, -0.0960025259275358, -0.1240751036479095, -0.0012866351608024, -0.0951531968133951, -0.1249951245615516, -0.0010895842964260, -0.0942977949061777, -0.1259421168812949, -0.0011771982033747, -0.0934636546649047, -0.1268804280522314, -0.0014938935513897, -0.0926735477845603, -0.1277822232471848, -0.0019915640361981, -0.0919459150749114, -0.1286268621299217, -0.0026302160193115, -0.0912948312507288, -0.1293994716480644, -0.0033778479018848, -0.0907295483843747, -0.1300889186994783, -0.0042096356974926, -0.0902536102052438, -0.1306854979963979, -0.0051067335340768, -0.0898635891817715, -0.1311786429329998, -0.0060548652587618, -0.0895476860718762, -0.1315550046498522, 0.0022657218675780, 0.0669276340337339, -0.0188541444521981, 0.0002147523203603, 0.0736037645141843, -0.0200767835699848, -0.0028441282934283, 0.0835216943873896, -0.0218798892397388, -0.0068844083049472, 0.0964463641025467, -0.0242245931257800, -0.0118640282654608, 0.1118779287579760, -0.0270576984220024, -0.0177187938742845, 0.1289446122121036, -0.0303128628886416, -0.0243549790448397, 0.1463833238667507, -0.0339114658093791, -0.0316434696115043, 0.1626938989249424, -0.0377640288676756, -0.0394161766493199, 0.1764689752650341, -0.0417730047823104, -0.0474667029779626, 0.1867511420420512, -0.0458356647012433, -0.0555569058711824, 0.1932109892108317, -0.0498474369535561, -0.0634307296303511, 0.1960692840710456, -0.0537053402081564, -0.0708345091868888, 0.1958669545017276, -0.0573115308817220, -0.0775402023512555, 0.1932375610646498, -0.0605766934077700, -0.0833674130313001, 0.1887646840298485, -0.0634230252903001, -0.0881994931785746, 0.1829255353076425, -0.0657865581922366, -0.0919909889289294, 0.1760884012523917, -0.0676186090454673, -0.0947653480274072, 0.1685332488207783, -0.0688864173511700, -0.0966046338904782, 0.1604770529220332, -0.0695730850689527, -0.0976337119868744, 0.1520956030199582, -0.0696771041553914, -0.0980021315460165, 0.1435392327497653, -0.0692117088701645, -0.0978664782191969, 0.1349425249772907, -0.0682041591477351, -0.0973752937083389, 0.1264290513590384, -0.0666949398562988, -0.0966580053607266, 0.1181125517021428, -0.0647367852852355, -0.0958184593960647, 0.1100959388060589, -0.0623933834906528, -0.0949330843390107, 0.1024693909788362, -0.0597376274472197, -0.0940528955711408, 0.0953085421847282, -0.0568493352175928, -0.0932084281705460, 0.0886733502534299, -0.0538124227902943, -0.0924158765557027, 0.0826079615498927, -0.0507116782366154, -0.0916831817873390, 0.0771415448898560, -0.0476293588941079, -0.0910148954157861, 0.0722899112713572, -0.0446419509369650, -0.0904150748868748, 0.0680576846629270, -0.0418174331764945, -0.0898881364365496, 0.0644407221469228, -0.0392133142780472, -0.0894380890657381, 0.0614286022543655, -0.0368755997647968, -0.0890665593678638, 0.0590070006078805, -0.0348386328582385, -0.0887700301297274, 0.0571598329012708, -0.0331256535143702, -0.0885369553084650, 0.0558710688304900, -0.0317497467353076, -0.0883453579540623, 0.0551261125996044, -0.0307149548935383, -0.0881615854164281, 0.0549126195248758, -0.0300172192100245, -0.0879410641214660, 0.0552206427255955, -0.0296449675117858, 0.1312317549321085, -0.2325175363572754, 0.0993416887059596, 0.1304724116728113, -0.2319026614092987, 0.0971978650438606, 0.1291774239689123, -0.2303004972246425, 0.0939085097542570, 0.1271678781045621, -0.2269111517821534, 0.0894018517782568, 0.1242205117203168, -0.2207506678367539, 0.0836087934901098, 0.1200823186914391, -0.2108240037677374, 0.0764823329593515, 0.1144909045071461, -0.1964181056013456, 0.0680163924769605, 0.1071995910083370, -0.1774393762696742, 0.0582608502982727, 0.0980071934026555, -0.1546085233362455, 0.0473320025198150, 0.0867916272252837, -0.1293418507563611, 0.0354163242851230, 0.0735417453696248, -0.1033508998031040, 0.0227662969102362, 0.0583811591067749, -0.0781967979062448, 0.0096888519117885, 0.0415773539240265, -0.0550203715831728, -0.0034725806906093, 0.0235314901483604, -0.0344941944535832, -0.0163604565719378, 0.0047487107132570, -0.0169106246964750, -0.0286272231057826, -0.0142060350002521, -0.0023060793952844, -0.0399579076757566, -0.0327583677015411, 0.0094342969971809, -0.0500883311077956, -0.0503721503530323, 0.0185064636113421, -0.0588170447527860, -0.0665873848168372, 0.0251469639992868, -0.0660106452378564, -0.0810447719929161, 0.0296118254513862, -0.0716032312236592, -0.0934965320886772, 0.0321661042090498, -0.0755915696459020, -0.1038054686259353, 0.0330780904774983, -0.0780277022139616, -0.1119355895963368, 0.0326147476759332, -0.0790103538506751, -0.1179379487828945, 0.0310368630166455, -0.0786760406258498, -0.1219349737040544, 0.0285936148971416, -0.0771903029570112, -0.1241053511744026, 0.0255170340548012, -0.0747391434801607, -0.1246702863342120, 0.0220170561695409, -0.0715206462929720, -0.1238807104789608, 0.0182779197422515, -0.0677367753292669, -0.1220045850006741, 0.0144562916454228, -0.0635854147357200, -0.1193136463515073, 0.0106812519374471, -0.0592530423411678, -0.1160697388488472, 0.0070559357457732, -0.0549084360876815, -0.1125119104281200, 0.0036604034989884, -0.0506979565403869, -0.1088458263407308, 0.0005551805317907, -0.0467426801403435, -0.1052367364858627, -0.0022150369494100, -0.0431375097127377, -0.1018063406491343, -0.0046179295467469, -0.0399520901999716, -0.0986331952801303, -0.0066306066302770, -0.0372330864833368, -0.0957556710357891, -0.0082372934364999, -0.0350072227370117, -0.0931765950927631, -0.0094276573405877, -0.0332845079727037, -0.0908688039974125, -0.0101957410523908, -0.0320610222863038, -0.0887812804334676, -0.0105394925937550, -0.0313208112653240, 0.1530580514529859, 0.0958844638501957, 0.1473693099259006, 0.1521022152458486, 0.1007185685977620, 0.1455073836176939, 0.1505675068159586, 0.1076177169877614, 0.1425628565602034, 0.1483433234003490, 0.1160664713674149, 0.1383795415463358, 0.1452964419108912, 0.1252504143475954, 0.1327865248223812, 0.1412858955913811, 0.1340308893415470, 0.1256247986342264, 0.1361798533333405, 0.1410350877942420, 0.1167778870415845, 0.1298766595931729, 0.1449057022546984, 0.1061996201815402, 0.1223293409663176, 0.1446462671112754, 0.0939377271241218, 0.1135688919517564, 0.1398833941183578, 0.0801484462780552, 0.1037225972816083, 0.1308871079523631, 0.0650996695412051, 0.0930220832751467, 0.1183646656818895, 0.0491617694840454, 0.0817965029145251, 0.1031862463716501, 0.0327850992675630, 0.0704485017278193, 0.0861827630677989, 0.0164664519306364, 0.0594163244435520, 0.0680550698319253, 0.0007087374154120, 0.0491282754951963, 0.0493631080742878, -0.0140204807069055, 0.0399587798393027, 0.0305504162870150, -0.0273252512117332, 0.0321937107590106, 0.0119746010334394, -0.0389072356949149, 0.0260099923082714, -0.0060694155121157, -0.0485787545725707, 0.0214703278104641, -0.0233361799147728, -0.0562630060763110, 0.0185310530724002, -0.0396246637292950, -0.0619838315557943, 0.0170590215824114, -0.0547781837307823, -0.0658484572748331, 0.0168530261278344, -0.0686860234378610, -0.0680268648841824, 0.0176663927246156, -0.0812841608438467, -0.0687308948138843, 0.0192283730907312, -0.0925535518032580, -0.0681951718643429, 0.0212634113073808, -0.1025154199612930, -0.0666611082078673, 0.0235080979576359, -0.1112238749035532, -0.0643643988316908, 0.0257261369587471, -0.1187568904489208, -0.0615258508231117, 0.0277207424733249, -0.1252068226406210, -0.0583451396630640, 0.0293437996903817, -0.1306715925140757, -0.0549970738550698, 0.0305005197929193, -0.1352473889379847, -0.0516298463048262, 0.0311488296919731, -0.1390232584291179, -0.0483649230984460, 0.0312934979972167, -0.1420776687695088, -0.0452981757301093, 0.0309758404311192, -0.1444767003253856, -0.0425020612789049, 0.0302607601685589, -0.1462733219111842, -0.0400283552666993, 0.0292231617336855, -0.1475071454812637, -0.0379110359182883, 0.0279353664540705, -0.1482040756840246, -0.0361691592732353, 0.0264571668783027, -0.1483755885415340, -0.0348093337394192, 0.0248296706633073, -0.1480175738852055, -0.0338275288447291, 0.0230731275301246, -0.1471090261493456, -0.0332101526705031, 0.1507305556008193, -0.1146213169913433, -0.1517049886048231, 0.1465495518154016, -0.1094960007769826, -0.1523977619090720, 0.1402062785978394, -0.1014426081036807, -0.1532324896301326, 0.1316388646736583, -0.0901277227890236, -0.1539800555941189, 0.1208000816962714, -0.0753021649171335, -0.1543613359335122, 0.1076873048680327, -0.0570002213963062, -0.1540657216648926, 0.0923752917685082, -0.0357468170662238, -0.1527771743524570, 0.0750506960796885, -0.0126621852781340, -0.1501975416663818, 0.0560417775964051, 0.0106606582787208, -0.1460709667746094, 0.0358363887672515, 0.0325077104437914, -0.1402045762715314, 0.0150812320059736, 0.0514468335788668, -0.1324829329237964, -0.0054436411953131, 0.0665696902997649, -0.1228765738593028, -0.0248783963150522, 0.0775022376722413, -0.1114431383278991, -0.0423579431483062, 0.0842683634845232, -0.0983218194863266, -0.0570951571851037, 0.0871259308819086, -0.0837215570439262, -0.0684579039913610, 0.0864425532247638, -0.0679051088913681, -0.0760249585188249, 0.0826238579020514, -0.0511714885617692, -0.0796130338448992, 0.0760813483974902, -0.0338389971012276, -0.0792741072546320, 0.0672228587437664, -0.0162305955134283, -0.0752685496880918, 0.0564526099534714, 0.0013377783399993, -0.0680229111801250, 0.0441731618740048, 0.0185662615306899, -0.0580816684378206, 0.0307853298950630, 0.0351781523739184, -0.0460607245199321, 0.0166845982286749, 0.0509258506842214, -0.0326075526576432, 0.0022541602012828, 0.0655961640543334, -0.0183693654531585, -0.0121444670996899, 0.0790150153413238, -0.0039683341010626, -0.0261818574303350, 0.0910514165845634, 0.0100187824623728, -0.0395705747275531, 0.1016202341693167, 0.0230793686580114, -0.0520732241636513, 0.1106831674069896, 0.0347824458775403, -0.0635077337962596, 0.1182474953394042, 0.0447938719456533, -0.0737491961228874, 0.1243623165831920, 0.0528862688473623, -0.0827281302479818, 0.1291123716478892, 0.0589407621794613, -0.0904255186080312, 0.1326099547626726, 0.0629389868899662, -0.0968650907693226, 0.1349852957788436, 0.0649457387948018, -0.1021034869267977, 0.1363764112079340, 0.0650851181656376, -0.1062188648425557, 0.1369189574034250, 0.0635139793107865, -0.1092986717083424, 0.1367367309769444, 0.0603969858513615, -0.1114271964114000, 0.1359332864852618, 0.0558868875330650, -0.1126736458329156, 0.1345850213161600, 0.0501134539459119, -0.1130818043463478, 0.1327362976930294, 0.0431823175141226, -0.1126623025588764, 0.1303969912456958};

const data_t W1[N_INPUTS][16] = {
	{0.1500633358955383, 0.3622178733348846, -0.0128361461684108, 0.0489422082901001, -0.0203665625303984, 0.3567892611026764, -0.1441605687141418, -0.0226483549922705, 0.3922579288482666, 0.4741554558277130, -0.3361973166465760, -0.5104748010635376, 0.1241453662514686, -0.1341591328382492, -0.1407140791416168, -0.3043427467346192},
	{-0.3263219892978668, 0.0527306310832500, 0.5215065479278564, -0.5331764817237854, -0.0172829162329435, 0.2652580738067627, -0.4239104688167572, 0.1481813639402390, 0.3152883946895600, -0.0730922222137451, 0.6876210570335388, -0.2671109437942505, 0.0326988026499748, -0.5400612354278564, -0.4103365838527680, 0.5342948436737061},
	{-0.0885644704103470, -0.3499788939952850, 0.2893818616867066, 0.1713262945413590, -0.1226022690534592, -0.0493505448102951, -0.3639806509017944, 0.6562058925628662, -0.2840385437011719, -0.1302657127380371, -0.1501329392194748, -0.2443271130323410, 0.1657519191503525, 0.2765158116817474, -0.6114380359649658, 0.0364715307950974},
	{-0.5351613759994507, 0.2230452299118042, -0.4203817546367646, 0.4104950726032257, -0.2417762726545334, -0.7575840353965759, -0.5186963677406311, 0.5262728929519653, 0.3594162166118622, 0.1772592365741730, -0.3434100449085236, 0.3510016202926636, 0.3374772071838379, 0.3967706561088562, -0.3157955110073090, -0.1841704696416855},
	{-0.2473602592945099, 0.5533310174942017, 0.2478027194738388, -0.0138148171827197, -0.4373994767665863, 0.1257609128952026, -0.8131538629531860, -0.3656194508075714, 0.8183938264846802, 0.4884013831615448, -0.2507293820381164, 0.4918491542339325, -0.6266636252403259, 0.8030258417129517, -0.0931185781955719, -0.3209361732006073},
	{0.3657161891460418, -0.2770759165287018, 0.2923126816749573, 0.1012064144015312, -0.6255999803543091, 0.3791035413742066, 0.1624005585908890, 0.2095064967870712, -0.0817337930202484, 0.6195901632308960, -0.7126064300537109, 0.1310861706733704, 0.1316947340965271, -0.0922165662050247, 0.4225052297115326, -0.1836774200201034},
	{0.4629284739494324, 0.4717547297477722, 0.4248996376991272, -0.1841879785060882, 0.0218221582472324, 0.8246757388114929, -0.0271981321275234, -0.0478712357580662, -0.6892178654670715, -0.0802566856145859, 0.0471416898071766, -0.0620359405875206, 0.4173155128955841, 0.0230497308075428, 0.4330617487430572, -0.1199085712432861},
	{0.5244318842887878, -0.1741802245378494, -0.6993212699890137, 0.1421118527650833, 0.6748093962669373, -0.1606092005968094, 0.3972194492816925, 0.2049901336431503, 0.0118456678465009, -0.1611402332782745, -0.4225181043148041, 0.7575616240501404, 0.9328287839889526, -0.4663427770137787, 0.6538669466972351, -0.0898561924695969},
	{-0.2332061529159546, 0.3262591958045960, -0.2786088287830353, 0.0406122505664825, 0.2109792232513428, -0.1099273487925530, 0.0385482795536518, -0.2496799826622010, -0.0163356978446245, 0.1435911506414414, -0.0457835905253887, -0.0822807177901268, 0.0011741510825232, 0.6219144463539124, 0.1037942767143250, -0.0049682729877532},
	{-0.1128940507769585, 0.0731606930494308, -0.1124745234847069, -0.1089925542473793, -0.3759367465972900, 0.0463257916271687, -0.4308890998363495, -0.2433410584926605, 0.8690729141235352, -0.1908458024263382, 0.0549373105168343, 0.6517234444618225, 0.0094265928491950, 0.6284463405609131, 0.1823181509971619, 0.1257037818431854},
	{0.5289380550384521, -0.2700927853584290, 0.3502119183540344, 0.2439429014921188, -0.0152710443362594, -0.0468083992600441, 0.2044775635004044, -0.2502652704715729, 0.6354153156280518, -0.0189677346497774, -0.0402745641767979, 0.4766624867916107, 0.4182898402214050, 0.3365866839885712, 0.5351122617721558, 0.2140883058309555},
	{0.2758233845233917, 0.3869449794292450, 0.1279802322387695, -0.1762536466121674, -0.0630390644073486, 0.0354050695896149, -0.0967208221554756, -0.1092378273606300, -0.0998715087771416, -0.3084552288055420, -0.4922134876251221, 0.1814437806606293, 0.1283923834562302, -0.4195207655429840, -0.3831926584243774, -0.1300726085901260},
	{-0.4037337601184845, 0.4173638522624970, -0.2892300486564636, 0.3043319582939148, 0.3766718506813050, 0.2893174886703491, -0.0166713688522577, -0.0626849010586739, 0.2213674336671829, 0.2318330705165863, 0.1968573480844498, 0.1402106583118439, 0.2828107476234436, 0.1134799048304558, 0.3981314897537232, 0.2693910598754883},
	{0.1915099322795868, -0.4419933855533600, -0.2785106599330902, -0.4205444455146790, 0.1324168741703034, 0.0838293433189392, -0.3376805782318115, 0.2570023536682129, 0.0732634142041206, 0.3327562212944031, -0.3099044859409332, 0.0387669727206230, -0.4818837344646454, -0.1718062907457352, -0.0172907430678606, 0.3553181290626526}
};

const data_t B1[16] = {0.1723258793354034, 0.3772084116935730, 0.2094413191080094, 0.1802175939083099, -0.0547188557684422, -0.0768157839775086, -0.1663295626640320, 0.1446011662483215, 0.3369644284248352, 0.0938324853777885, -0.2187156379222870, 0.3121192157268524, 0.1819620877504349, 0.3896289169788360, 0.0171183962374926, 0.0107011320069432};

const data_t W2[16][16] = {
	{-0.0319894514977932, -0.0447189770638943, -0.1345914006233215, 0.2982167601585388, 0.2906803190708160, 0.4011425077915192, -0.2185004204511642, -0.2510251700878144, -0.9530916213989258, 0.1914474070072174, 0.2091065645217896, 0.3511120378971100, -0.3859523832798004, 0.2048178315162659, 0.0883804783225060, 0.1719393730163574},
	{-0.3301423192024231, -0.3650976121425628, -0.3969944715499878, -0.0990862101316452, -0.4416219294071198, 0.2848870158195496, 0.0498280450701714, 0.3628084063529968, 0.4538237154483795, 0.1801532208919525, 0.0350457876920700, -0.0827386453747749, -0.1408721208572388, 0.0559880025684834, 0.2579990625381470, 0.0338565371930599},
	{0.0395764224231243, -0.4456262290477752, 0.1464490294456482, -0.2501846551895142, -0.1362960487604141, 0.2629289031028748, -0.0298836883157492, -0.0248627290129662, -0.3084863126277924, 0.2156236916780472, 0.2350480109453202, -0.1113440245389938, -0.0508113987743854, -0.2284024357795716, -0.1987875103950500, 0.0655715838074684},
	{0.0873635858297348, -0.3280374407768250, -0.3839970529079438, -0.4253496825695038, 0.2297160327434540, 0.3278829455375672, 0.1263004392385483, -0.0896025523543358, -0.2595259547233582, -0.1320355236530304, -0.1014042273163796, -0.0973465666174889, -0.4064490199089050, 0.0133967734873295, -0.3916442096233368, -0.4633264243602753},
	{0.3264647722244262, 0.3362261950969696, 0.3126906454563141, -0.0682801008224487, 0.3505634367465973, 0.4566192030906677, -0.4038969278335572, -0.1256941407918930, -0.0562016069889069, -0.2002062052488327, -0.1711073219776154, -0.4282630681991577, 0.0300211329013109, 0.2493064403533936, 0.3064075112342834, -0.1486877053976059},
	{-0.6380584239959717, 0.3483365774154663, -0.0151999564841390, -0.0880214571952820, 0.1580852568149567, -0.2273252159357071, 0.0269466917961836, -0.1728914082050324, 0.2327544540166855, 0.4456566572189331, -0.2933336198329926, -0.1934115290641785, 0.0406608693301678, -0.4497642815113068, -0.2892823219299316, 0.5099225044250488},
	{0.5600835084915161, 0.1361716240644455, 0.1439969092607498, -0.2183057665824890, 0.2324084341526032, 0.1605058461427688, 0.1511595100164414, -0.3321703076362610, -0.0019843357149512, -0.0145423468202353, -0.2980481088161468, 0.0045634759590030, -0.3207094371318817, -0.6138033866882324, -0.2941690683364868, 0.2961062490940094},
	{-0.0881098136305809, -0.4416747689247132, 0.3172365725040436, 0.2213326394557953, 0.0393325649201870, 0.1619919538497925, 0.4437891840934754, -0.4837177395820618, 0.2423685789108276, -0.3529736697673798, 0.2904932796955108, 0.3616534471511841, 0.0684579461812973, 0.1283479332923889, 0.3522860407829284, -0.1934137493371964},
	{0.0742518231272698, -0.2424541711807251, 0.3141489923000336, -0.1125516593456268, -0.1045805141329765, -0.2584185600280762, -0.0606102794408798, 0.2866442501544952, 0.3305704295635224, -0.3458682000637054, 0.4984352886676788, -0.0199450068175793, 0.1041262969374657, 0.5950001478195190, -0.2583277821540832, 0.3113562762737274},
	{-0.0938856229186058, -0.0422816090285778, -0.3744809627532959, -0.1365824937820434, -0.1728660315275192, 0.3382252752780914, 0.4255914688110352, 0.2831240594387054, 0.3023392558097840, 0.3527956604957580, -0.4395448565483094, 0.1085763499140740, -0.3016289472579956, 0.0227258671075106, 0.1596867889165878, -0.1044035851955414},
	{-0.1419602036476135, -0.0242021996527910, 0.0173425078392029, 0.2005130797624588, 0.3281207084655762, -0.3707966506481170, -0.2537193000316620, 0.4593676626682281, -0.3658628463745117, -0.3321605622768402, -0.1796302944421768, -0.0420725680887699, 0.4215466976165772, -0.2984017133712768, 0.2619599699974060, 0.3498632609844208},
	{0.2920948266983032, -0.0407112203538418, 0.1144764646887779, 0.5212201476097107, 0.3431694507598877, -0.0846693888306618, 0.5412038564682007, 0.3495540320873260, -0.5572282075881958, -0.2253327965736389, 0.2367551475763321, 0.0248889438807964, 0.0640569254755974, 0.0365747064352036, 0.1950898766517639, -0.0666959881782532},
	{0.3882251083850860, 0.2161588966846466, -0.1173532009124756, 0.1788905858993530, -0.0081640705466270, 0.3083685040473938, 0.1384408473968506, -0.2586191296577454, -0.2276859879493714, 0.1748663038015366, 0.4647589325904846, 0.3793662190437317, 0.2181895375251770, 0.0591082498431206, -0.2967121005058288, 0.0537919141352177},
	{-0.1679468899965286, 0.2318297922611236, -0.1273211538791656, -0.3283475041389466, -0.0124933701008558, -0.0055795311927795, 0.2426302582025528, 0.4594609439373016, 0.0888476669788361, -0.0747066885232925, -0.2082385718822479, -0.2833586335182190, 0.3564554154872894, 0.2780536711215973, -0.3895879983901978, -0.1080691143870354},
	{0.5796763300895691, -0.3723980486392975, -0.1982485502958298, -0.1531949043273926, 0.1350076496601105, 0.4773479998111725, -0.2528672814369202, -0.1482759118080139, -0.6476228833198547, -0.2185126245021820, -0.9211689233779908, -0.6218461990356445, -0.2057197988033295, 0.1110035628080368, -0.2297674864530564, 0.2690067291259766},
	{0.1150185018777847, -0.1776512861251831, 0.0571212172508240, 0.4020864665508270, 0.3133965432643890, -0.3226346373558044, -0.1076480373740196, 0.2814612984657288, -0.2844648957252502, 0.0993632450699806, 0.0709034577012062, -0.0927572026848793, 0.3454857468605042, -0.3806012570858002, -0.4623021483421326, 0.1997498720884323}
};

const data_t B2[16] = {-0.1547458767890930, -0.0929424539208412, -0.0594572648406029, 0.1302010416984558, -0.3047257959842682, 0.2387270927429199, 0.4277483820915222, 0.0520063973963261, 0.1868777275085449, 0.1402144581079483, 0.2901007831096649, 0.0833862945437431, 0.1634995341300964, 0.3148392736911774, -0.0413003601133823, 0.1195853874087334};

const data_t W3[16][4] = {
	{-0.4180293679237366, -0.8060236573219299, -0.2187499403953552, 0.2561666369438172},
	{-0.2949403524398804, -0.3587723076343536, 0.1730666160583496, -0.1694421768188476},
	{0.2716437578201294, -0.4269064962863922, 0.0017280658939853, -0.5064960718154907},
	{-0.1398748159408569, -0.6412317752838135, 0.2978848814964294, -0.0395528003573418},
	{-0.5431287884712219, -0.4215399026870728, 0.2958307862281800, 0.4079173803329468},
	{0.1462046951055527, 0.1209259703755379, -0.6842395663261414, 0.0405878983438015},
	{0.5874112844467163, -0.2284247279167176, -0.4895542562007904, -0.2737946212291718},
	{-0.0598044544458389, 0.3109867870807648, -0.0543302968144417, -0.4233675897121430},
	{-0.4553871452808380, -0.5842235088348389, 0.7748193740844727, -0.3864280283451080},
	{-0.4329603314399719, 0.4618311226367950, -0.2766077220439911, -0.4634883403778076},
	{-0.2419473826885224, -0.3570020496845246, 0.2912181019783020, -1.0350927114486694},
	{0.4851913750171661, 0.3827306926250458, -0.1125216335058212, -0.0810383334755898},
	{-0.3120861649513244, -0.3274112045764923, 0.6559697389602661, -0.1933873593807220},
	{0.8354405164718628, -1.1313562393188477, -0.1469741314649582, -0.5258777737617493},
	{-0.4762617051601410, 0.2434034943580628, 0.4221572875976562, -0.4771863818168640},
	{-0.6889457702636719, 0.5103711485862732, -0.4338645040988922, -0.2266801148653030}
};

const data_t B3[N_OUTPUTS] = {0.2976344525814056, -0.0720020309090614, -0.0054520596750081, -0.1683145463466644};

void print_arr(data_t arr[], int size) {
    for (int i = 0; i < size; i++) {
        printf("arr[%d] = %f\n", i, arr[i]);
    }
}


data_t relu(data_t x) {
    return x < 0 ? (data_t)0.0 : x;
}

data_t sigmoid(data_t x) {
    return 1.0 / (1.0 + std::exp(-x));
}

void softmax(data_t input[N_OUTPUTS], data_t output[N_OUTPUTS]) {
    data_t max_val = input[0];
    for (int i = 1; i < N_OUTPUTS; i++) {
        if (input[i] > max_val) {
            max_val = input[i];
        }
    }

    data_t sum = 0.0;
    for (int i = 0; i < N_OUTPUTS; i++) {
        output[i] = std::exp(input[i] - max_val);
        sum += output[i];
    }

    for (int i = 0; i < N_OUTPUTS; i++) {
        output[i] /= sum;
    }
}

void pca_mlp(data_t input[VIVADO_INPUTS]){

	data_t action[40][3];
	    for (int i = 0; i < 40; i++) {
	        for (int j = 0; j < 3; j++) {
	            action[i][j] = input[i*3+j];
	        }
	    }

	    data_t scaled_action[40][3];
	    for (int i = 0; i < 40; i++) {
	        for (int j = 0; j < 3; j++) {
	            scaled_action[i][j] = (action[i][j] - mean[i*3+j]) / std::sqrt(variance[i*3+j]);
	        }
	    }

	    data_t scaled_action_vec[120];
	    int k = 0;
	    for (int i = 0; i < 40; i++) {
	        for (int j = 0; j < 3; j++) {
	            scaled_action_vec[k] = scaled_action[i][j];
	            k++;
	        }
	    }

	// declare a 2D array with dimensions 120 x 5
	data_t pca_eigvecs_2d[PCA_COMPONENTS][120];

	// copy the data from the 1D array to the 2D array
	for (int i = 0; i < PCA_COMPONENTS; i++) {
		for (int j = 0; j < 120; j++) {
			pca_eigvecs_2d[i][j] = pca_eigvecs[120*i + j];
		}
	}

	data_t pca_action[PCA_COMPONENTS];
	for (int i = 0; i < PCA_COMPONENTS; i++) {
		pca_action[i] = 0;
		for (int j = 0; j < 120; j++) {
			pca_action[i] += scaled_action_vec[j] * pca_eigvecs_2d[i][j];
		}
	}

	data_t mlp_input[N_INPUTS];
	for (int i = 0; i < PCA_COMPONENTS; i++) {
		mlp_input[i] = pca_action[i];
	}
	for (int i = 0; i < N_INPUTS-PCA_COMPONENTS; i++) {
		mlp_input[PCA_COMPONENTS+i] = input[120+i];
	}


// Compute the output of the hidden layer
data_t hidden1[N_HIDDEN_1];
for (int i = 0; i < N_HIDDEN_1; i++) {
		hidden1[i] = B1[i];
		for (int j = 0; j < N_INPUTS; j++) {
			hidden1[i] += mlp_input[j] * W1[j][i];
		}
		hidden1[i] = relu(hidden1[i]);
	}

	// print array for hidden
	// print_arr(hidden1, N_HIDDEN_1);

	// for (int i = 0; i < 1; i++) {
	// 	for (int j = 0; j < 20; j++) {
	// 		std::cout << hidden1[j] << " ";
	// 	}
	// 	std::cout << std::endl;
	// }

	// Compute the output of the second hidden layer
	data_t hidden2[N_HIDDEN_2];
	for (int i = 0; i < N_HIDDEN_2; i++) {
		hidden2[i] = B2[i];
		for (int j = 0; j < N_HIDDEN_1; j++) {
			hidden2[i] += hidden1[j] * W2[j][i];
		}
		hidden2[i] = relu(hidden2[i]);
	}

	// Compute the output of the output layer
	data_t output_raw[N_OUTPUTS];
	data_t output[N_OUTPUTS];
	for (int i = 0; i < N_OUTPUTS; i++) {
		output_raw[i] = B3[i];
		for (int j = 0; j < N_HIDDEN_2; j++) {
			output_raw[i] += hidden2[j] * W3[j][i];
		}
	}
	softmax(output_raw, output);

		print_arr(output, 4);
}

int main() {
    data_t test_case[128] = {0.0003552745986771, -0.0000639194028700, 0.0002303774115284, 0.0011025112927649, -0.0002047728086971, 0.0006943783263803, 0.0023128047358510, -0.0004479481342828, 0.0013969196602337, 0.0040868280866819, -0.0008291901393962, 0.0023416020550211, 0.0065459975024572, -0.0013905113381097, 0.0035268597855410, 0.0098192569366106, -0.0021725194648348, 0.0049414704123553, 0.0140249718498973, -0.0032024751529702, 0.0065601270737166, 0.0192476394503200, -0.0044781330077282, 0.0083401935928410, 0.0255114156860716, -0.0059485501619651, 0.0102209606933377, 0.0327544360655782, -0.0074940397537901, 0.0121260484106529, 0.0408077606226740, -0.0089094532638058, 0.0139699206872757, 0.0493859494367730, -0.0098951600034512, 0.0156675566433661, 0.0580929125867615, -0.0100598385804224, 0.0171464062250145, 0.0664460093891809, -0.0089375897365667, 0.0183580005263141, 0.0739187879269731, -0.0060203838921816, 0.0192870149671635, 0.0799964759705402, -0.0008031359386028, 0.0199550632009724, 0.0842372875799682, 0.0071624117781013, 0.0204172511490184, 0.0863300889783527, 0.0182137577788571, 0.0207508948668976, 0.0861370877485206, 0.0325296431037084, 0.0210400901122189, 0.0837145137940554, 0.0500950597921421, 0.0213583881174552, 0.0793078428725786, 0.0706843311792588, 0.0217540192040862, 0.0733230587649375, 0.0938644336035578, 0.0222414667055428, 0.0662796976591085, 0.1190179944410504, 0.0228016358303572, 0.0587537634159518, 0.1453834352366487, 0.0233912229029516, 0.0513206158404606, 0.1721090009331563, 0.0239571134650047, 0.0445037797587669, 0.1983137889655971, 0.0244531364669633, 0.0387342605969570, 0.2231520745144197, 0.0248546008627003, 0.0343239759341889, 0.2458750518153205, 0.0251664079410716, 0.0314516336583082, 0.2658850844305493, 0.0254224647495891, 0.0301599072220813, 0.2827769691372332, 0.0256774107652960, 0.0303624164666969, 0.2963620528479575, 0.0259926652715260, 0.0318582391487248, 0.3066721171666196, 0.0264210188525332, 0.0343533018477244, 0.3139420804886847, 0.0269935420409305, 0.0374868645069817, 0.3185728011162742, 0.0277120495796295, 0.0408625369564649, 0.3210779600702935, 0.0285484126299378, 0.0440815190703251, 0.3220211744613614, 0.0294504639765775, 0.0467759937495504, 0.3219506801743304, 0.0303527809755716, 0.0486398467696290, 0.3213382939738236, 0.0311901850508043, 0.0494539745688875, 0.3205287889845441, 0.0319107264525637, 0.0491039745688875, 0.3197037889845441, 0.0324857264525637, 0.0487486999702105, 0.3197677083874141, 0.0322553490410353, 1.0000000000000000, 0.0000000000000000, 0.1524503528390961, 1.5113369230074778, 9.9136334869793323};
	pca_mlp(test_case);
    return 0;
}